// Module included in the following assemblies:
//
// observability/logging/log6x-clf.adoc


:_mod-docs-content-type: REFERENCE
[id="log6x-code-samples"]
= Code Samples

[source,yaml]
----
# Metadata Section: Defines the basic identification of the resource
apiVersion: observability.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  name: logging  # Name of the ClusterLogForwarder resource
  namespace: openshift-logging  # Namespace where the resource is located

# Spec Section: Configures the audit policy with rules for logging
rules:
  # Rule Section: Specifies the actions that should be logged
  - level: Metadata  # Log request metadata (including URI, verb, and user) for matched requests
    verbs: ["create", "update", "patch", "delete"]  # Specify the HTTP verbs to audit
    resources:
      - group: ""  # Empty string refers to the core API group
        resources: ["pods"]  # Apply the rule to pod resources
    namespaces: ["default", "kube-system"]  # Limit the rule to specific namespaces
    omitStages: ["RequestReceived"]  # Exclude specific audit stages from logging

  # Another Rule Section: Logging all other requests at the 'None' level
  - level: None  # Do not log requests that do not match any other rules

# OmitStages Section: Specifies stages of request processing to be excluded from audit logs
omitStages:
  - "RequestReceived"  # Exclude the initial request receipt from audit logs
----


[source,yaml]
----
apiVersion: observability.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  name: logging
  namespace: openshift-logging

spec:
  collector:
    nodeSelector:
      kubernetes.io/os: linux 

# Filters Section: Define filters to process logs
  filters:
  - name: add-label             # <1>
    openShiftLabels:
      custom-labels-added: "true"  # <2>
    type: openShiftLabels          # <3>

# Inputs Section: Specify sources of logs
  inputs:
  - application:
      includes:
      - namespace: project-qa-1    # <4>
      - namespace: project-qa-2    # <5>
      selector:
        matchLabels:
          test: centos-logtest     # <6>
    name: selected-app-logs         # <7>
    type: application               # <8>

  managementState: Managed
# Outputs Section: Define where to send the processed logs
  outputs:
  - lokiStack:
      authentication:
        token:
          from: serviceAccount      # <9>
      target:
        name: lokistack-sample      # <10>
        namespace: openshift-logging  # <11>
    name: default                   # <12>
    tls:
      ca:
        configMapName: openshift-service-ca.crt  # <13>
        key: service-ca.crt                      # <14>
    type: lokiStack                # <15>
  # Pipelines Section: Define how inputs, filters, and outputs are connected
  pipelines:
  - filterRefs:
    - add-label                    # <16>
    inputRefs:
    - selected-app-logs            # <17>
    name: pipe1                    # <18>
    outputRefs:
    - default                      # <19>

  serviceAccount:
    name: logcollector             # <20>
----
<1> Defines a filter named `add-label`.
<2> Adds a custom label `custom-labels-added` with a value of `true`.
<3> Specifies the filter type as `openShiftLabels`.
<4> Includes logs from the `project-qa-1` namespace.
<5> Includes logs from the `project-qa-2` namespace.
<6> Selects pods with the label `test: centos-logtest`.
<7> Names this input configuration as `selected-app-logs`.
<8> Sets the input type to `application`.
<9> Specifies the token authentication method for LokiStack using a service account.
<10> Names the target LokiStack as `lokistack-sample`.
<11> Specifies the target namespace for the LokiStack as `openshift-logging`.
<12> Names this output configuration as `default`.
<13> Specifies the ConfigMap containing the CA certificate.
<14> Identifies the key within the ConfigMap that contains the CA certificate.
<15> Sets the output type to `lokiStack`.
<16> References the `add-label` filter in the pipeline.
<17> References the `selected-app-logs` input in the pipeline.
<18> Names the pipeline as `pipe1`.
<19> References the `default` output in the pipeline.
<20> Specifies the service account used by the log collector.
