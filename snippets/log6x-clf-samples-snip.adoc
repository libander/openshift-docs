[id="clusterlogforwarder-examples_{context}"]
= ClusterLogForwarder examples

This section provides examples of ClusterLogForwarder custom resources (CRs) for various logging configurations. These examples demonstrate different use cases and can be adapted to suit your specific logging requirements.

These examples demonstrate the following configurations:

////
Tags/use cases:
elasticsearch-output
lokistack-output
cloudwatch-output
elasticsearch-custom-index
input-receivers
////

* Forwarding logs to Elasticsearch
* Sending logs to LokiStack
* Forwarding infrastructure logs to AWS CloudWatch
* Using custom index patterns with Elasticsearch
* Configuring HTTP and Syslog receivers

[NOTE]
====
These examples are provided as starting points. Modify the configurations to match your specific logging requirements and security policies.
====



// tag::elasticsearch-output[]
.Elasticsearch output
[source,yaml]
----
apiVersion: "observability.openshift.io/v1"
kind: ClusterLogForwarder
metadata:
  name: instance
  namespace: openshift-logging
spec:
  outputs:
  - name: elasticsearch-output
    type: elasticsearch
    elasticsearch:
      url: https://elasticsearch.example.com:9200 <1>
      version: 6 <2>
      index: "{.log_type}-write" <3>
    tls:
      ca:
        key: ca-bundle.crt
        secretName: elasticsearch-secret <4>
  pipelines:
  - inputRefs:
    - application
    - infrastructure <5>
    outputRefs:
    - elasticsearch-output
----
<1> Specify the URL of your Elasticsearch cluster.
<2> Set the Elasticsearch version for compatibility.
<3> Define the index pattern using the log type.
<4> Reference a secret containing TLS certificates.
<5> Include both application and infrastructure logs in the pipeline.
// end::elasticsearch-output[]

// tag::lokistack-output[]
.LokiStack output
[source,yaml]
----
apiVersion: "observability.openshift.io/v1"
kind: ClusterLogForwarder
metadata:
  name: instance
  namespace: openshift-logging
spec:
  outputs:
  - name: loki-output
    type: lokiStack
    lokiStack:
      target:
        name: logging-loki <1>
        namespace: openshift-logging
  pipelines:
  - inputRefs:
    - application
    - infrastructure
    - audit <2>
    outputRefs:
    - loki-output
----
<1> Specify the name of your LokiStack instance.
<2> Include application, infrastructure, and audit logs in the pipeline.
// end::lokistack-output[]

// tag::cloudwatch-output[]
.CloudWatch output
[source,yaml]
----
apiVersion: "observability.openshift.io/v1"
kind: ClusterLogForwarder
metadata:
  name: instance
  namespace: openshift-logging
spec:
  outputs:
  - name: cloudwatch-output
    type: cloudwatch
    cloudwatch:
      region: us-west-2 <1>
      groupBy: logType <2>
      groupPrefix: openshift-cluster <3>
  pipelines:
  - inputRefs:
    - infrastructure <4>
    outputRefs:
    - cloudwatch-output
----
<1> Set the AWS region for CloudWatch.
<2> Group logs by log type in CloudWatch.
<3> Add a prefix to CloudWatch log groups for identification.
<4> Forward only infrastructure logs to CloudWatch.
// end::cloudwatch-output[]


//tag::elasticsearch-custom-index[]
.Elasticsearch custom index
[source,yaml]
----
apiVersion: "observability.openshift.io/v1"
kind: ClusterLogForwarder
metadata:
  name: instance
  namespace: openshift-logging
spec:
  outputs:
  - name: elasticsearch-custom
    type: elasticsearch
    elasticsearch:
      url: 'https://elasticsearch.example.com:9200'
      index: '{.kubernetes.namespace_name}-{.log_type}' <1>
  pipelines:
  - inputRefs:
    - application
    outputRefs:
    - elasticsearch-custom
----
<1> Create custom indices using namespace name and log type.
// end::elasticsearch-custom-index[]

// tag::input-receivers[]
.Input receivers
[source,yaml]
----
apiVersion: "observability.openshift.io/v1"
kind: ClusterLogForwarder
metadata:
  name: instance
  namespace: openshift-logging
spec:
  inputs:
  - name: http-receiver
    type: receiver
    receiver:
      type: http
      port: 8443 <1>
      http:
        format: kubeAPIAudit <2>
  - name: syslog-receiver
    type: receiver
    receiver:
      type: syslog
      port: 9542 <3>
  pipelines:
  - inputRefs:
    - http-receiver
    - syslog-receiver
    outputRefs:
    - default <4>
----
<1> Set the port for the HTTP receiver.
<2> Specify the format for Kubernetes API audit logs.
<3> Set the port for the Syslog receiver.
<4> Forward logs from both receivers to the default output.
// end::input-receivers[]
