:_mod-docs-content-type: ASSEMBLY
include::_attributes/common-attributes.adoc[]
[id="log6x-loki"]
= Storing logs with LokiStack
:context: logging-6x

toc::[]

== Installation
Partial includes of modules/logging-loki-cli-install.adoc & logging-loki-gui-install.adoc once https://github.com/openshift/openshift-docs/pull/77407/ is merged.




// All of these need to be validated by engineering for 6.0.
include::modules/logging-enabling-loki-alerts.adoc[leveloffset=+1]

include::modules/logging-loki-memberlist-ip.adoc[leveloffset=+1]

//include::modules/logging-loki-log-access.adoc[leveloffset=+1]

include::modules/logging-identity-federation.adoc[leveloffset=+1]

include::modules/logging-loki-log-access.adoc[leveloffset=+1]

include::modules/logging-loki-pod-placement.adoc[leveloffset=+1]

include::modules/logging-loki-reliability-hardening.adoc[leveloffset=+1]

include::modules/logging-loki-restart-hardening.adoc[leveloffset=+1]

include::modules/logging-loki-retention.adoc[leveloffset=+1]

include::modules/logging-loki-zone-aware-rep.adoc[leveloffset=+1]

include::modules/logging-loki-zone-fail-recovery.adoc[leveloffset=+1]

include::modules/loki-rate-limit-errors.adoc[leveloffset=+1]

include::modules/loki-rbac-rules-permissions.adoc[leveloffset=+1]

== Loki Architecture: Understanding the Components
Loki is a distributed system with several core components, each serving a specific purpose in the logging pipeline:

* **Distributor:**  Receives incoming log streams, validates them, and distributes them to the appropriate ingesters.
* **Ingester:**  Builds chunks of log data and creates an index to enable efficient querying.
* **Querier:**  Executes queries against the log data, retrieving relevant log entries from the ingesters and storage backend.
* **Query Frontend:**  Manages and coordinates incoming queries, distributes the workload across queriers, and returns the query results.
* **Storage Backend:**  Persists the log data and index, typically using an object storage like Amazon S3 or Google Cloud Storage.
* **Compactor:**  Optimizes the storage of log data by compacting older log chunks into a more efficient format.
* **Ruler:**  Allows you to define rules for alerting and recording based on log data patterns.

[discrete]
=== Distributor:

* `spec.distributor.replicas`: Controls the number of distributor replicas.
* `spec.distributor.resources`: Sets resource limits (CPU, memory) for the distributor pods.
* `spec.distributor.ring`: Configures the hash ring for distributing log streams among ingesters.

[discrete]
=== Ingester:

* `spec.ingester.replicas`: Controls the number of ingester replicas.
* `spec.ingester.resources`: Sets resource limits (CPU, memory) for the ingester pods.
* `spec.ingester.lifecycler`: Configures the ingester lifecycle, including chunk lifecycle and table manager settings.
* `spec.ingester.persistence`: Configures the persistent storage for ingester data (e.g., volume claims, storage class).

[discrete]
=== Querier:

* `spec.querier.replicas`: Controls the number of querier replicas.
* `spec.querier.resources`: Sets resource limits (CPU, memory) for the querier pods.
* `spec.querier.queryRange`: Configures the default query range (time duration) for queriers.
* `spec.querier.storeGateway`: Configures the interaction between queriers and the storage backend.

[discrete]
=== Query Frontend:

* `spec.queryFrontend.replicas`: Controls the number of query frontend replicas.
* `spec.queryFrontend.resources`: Sets resource limits (CPU, memory) for the query frontend pods.
* `spec.queryFrontend.grpcServer`: Configures the gRPC server for the query frontend.

[discrete]
=== Storage Backend:

* `spec.storageConfig`:  Specifies the type of storage backend (e.g., S3, GCS, local filesystem) and its configuration parameters (e.g., bucket name, credentials).

[discrete]
=== Compactor:

* `spec.compactor.replicas`: Controls the number of compactor replicas.
* `spec.compactor.resources`: Sets resource limits (CPU, memory) for the compactor pods.
* `spec.compactor.workingDirectory`: Specifies the working directory for the compactor.
* `spec.compactor.sharedStore`: Configures the shared storage for compactor data.

[discrete]
=== Ruler:

* `spec.ruler.replicas`: Controls the number of ruler replicas.
* `spec.ruler.resources`: Sets resource limits (CPU, memory) for the ruler pods.
* `spec.ruler.alertmanagerURL`: Specifies the URL of the Alertmanager instance to send alerts to.
* `spec.ruler.ruleNamespaceSelector`: Selects the namespaces from which to load ruler rules.
* `spec.ruler.storage`: Configures the storage for ruler data.
