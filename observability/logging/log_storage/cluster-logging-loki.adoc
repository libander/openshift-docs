:_mod-docs-content-type: ASSEMBLY
:context: cluster-logging-loki
[id="cluster-logging-loki"]
= Configuring the LokiStack log store
include::_attributes/common-attributes.adoc[]

toc::[]

In {logging} documentation, _LokiStack_ refers to the {logging} supported combination of Loki and web proxy with {product-title} authentication integration. LokiStack's proxy uses {product-title} authentication to enforce multi-tenancy. _Loki_ refers to the log store as either the individual component or an external store.

++++
<div id="code-container" style="position: relative;">
  <button onclick="copyToClipboard()" style="position: absolute; top: 0; right: 0; margin: 10px;">Copy</button>
  <pre><code>
apiVersion: loki.grafana.com/v1
kind: LokiStack
metadata:
  name: logging-loki
  namespace: openshift-logging
spec:
  size: <input type="text" value="1x.small" class="editable-input">
  storage:
    schemas:
    - version: v12
      effectiveDate: "2022-06-01"
    secret:
      name: <input type="text" value="logging-loki-s3" class="editable-input">
      type: <input type="text" value="s3" class="editable-input">
      credentialMode: <input type="text" placeholder="Enter mode" class="editable-input">
  storageClassName:  <input type="text" placeholder="Enter mode" class="editable-input">
  tenants:
    mode: openshift-logging
  </code></pre>
</div>

<style>
#code-container {
  position: relative;
  background-color: #f4f4f4;
  border: 1px solid #ccc;
  padding: 10px;
  overflow: auto;
}

.editable-input {
  border: 1px solid #ccc;
  background: none;
  width: auto;
  margin: 0;
  padding: 2px;
  font-family: monospace;
  font-size: 0.9em;
}

button {
  padding: 5px 10px;
  font-size: 1em;
  cursor: pointer;
  background-color: white;
  border: 1px solid #ccc;
}
</style>

<script>
function copyToClipboard() {
  let textToCopy = 'apiVersion: loki.grafana.com/v1\n';
  textToCopy += 'kind: LokiStack\n';
  textToCopy += 'metadata:\n';
  textToCopy += '  name: logging-loki\n';
  textToCopy += '  namespace: openshift-logging\n';
  textToCopy += 'spec:\n';
  textToCopy += '  size: ' + document.querySelector('input[value="1x.small"]').value + '\n';
  textToCopy += '  storage:\n';
  textToCopy += '    schemas:\n';
  textToCopy += '    - version: v12\n';
  textToCopy += '      effectiveDate: "2022-06-01"\n';
  textToCopy += '    secret:\n';
  textToCopy += '      name: ' + document.querySelector('input[value="logging-loki-s3"]').value + '\n';
  textToCopy += '      type: ' + document.querySelector('input[value="s3"]').value + '\n';
  textToCopy += '      credentialMode: ' + document.querySelector('input[placeholder="Enter mode"]').value + '\n';
  textToCopy += '  storageClassName: <storage_class_name>\n';
  textToCopy += '  tenants:\n';
  textToCopy += '    mode: openshift-logging';

  navigator.clipboard.writeText(textToCopy).then(() => {
    alert('Copied to clipboard!');
  }).catch(err => {
    console.error('Failed to copy: ', err);
  });
}
</script>
++++



include::modules/logging-creating-new-group-cluster-admin-user-role.adoc[leveloffset=+1]

include::modules/logging-loki-restart-hardening.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources
* link:https://kubernetes.io/docs/concepts/workloads/pods/disruptions/#pod-disruption-budgets[Pod disruption budgets Kubernetes documentation]

include::modules/logging-loki-reliability-hardening.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources
* link:https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.24/#podantiaffinity-v1-core[`PodAntiAffinity` v1 core Kubernetes documentation]
* link:https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#inter-pod-affinity-and-anti-affinity[Assigning Pods to Nodes Kubernetes documentation]
* xref:../../../nodes/scheduling/nodes-scheduler-pod-affinity.adoc#nodes-scheduler-pod-affinity[Placing pods relative to other pods using affinity and anti-affinity rules]

include::modules/logging-loki-zone-aware-rep.adoc[leveloffset=+1]

include::modules/logging-loki-zone-fail-recovery.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources
* link:https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/#spread-constraint-definition[Topology spread constraints Kubernetes documentation]
* link:https://kubernetes.io/docs/setup/best-practices/multiple-zones/#storage-access-for-zones[Kubernetes storage documentation].

ifdef::openshift-enterprise[]
* xref:../../../nodes/scheduling/nodes-scheduler-pod-topology-spread-constraints.adoc#nodes-scheduler-pod-topology-spread-constraints-configuring[Controlling pod placement by using pod topology spread constraints]
endif::[]

include::modules/logging-loki-log-access.adoc[leveloffset=+1,tag=!NetObservMode]

[role="_additional-resources"]
.Additional resources

ifdef::openshift-enterprise[]
* xref:../../../authentication/using-rbac.adoc#using-rbac[Using RBAC to define and apply permissions]
endif::[]

include::modules/logging-loki-retention.adoc[leveloffset=+1]
include::modules/loki-rate-limit-errors.adoc[leveloffset=+1]
include::modules/logging-loki-memberlist-ip.adoc[leveloffset=+1]

[role="_additional-resources"]
[id="additional-resources_cluster-logging-loki"]
== Additional Resources
* link:https://grafana.com/docs/loki/latest/get-started/components/[Loki components documentation]
* link:https://grafana.com/docs/loki/latest/logql/[Loki Query Language (LogQL) documentation]
* link:https://loki-operator.dev/docs/howto_connect_grafana.md/[Grafana Dashboard documentation]
* link:https://loki-operator.dev/docs/object_storage.md/[Loki Object Storage documentation]
* link:https://loki-operator.dev/docs/api.md/#loki-grafana-com-v1-IngestionLimitSpec[{loki-op} `IngestionLimitSpec` documentation]
* link:https://grafana.com/docs/loki/latest/operations/storage/schema/#changing-the-schema[Loki Storage Schema documentation]
